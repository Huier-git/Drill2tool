# 传感器模拟器快速使用指南

## 一键启动所有模拟器

### Windows
双击运行：
```
start_all_simulators.bat
```

这将启动 3 个模拟器窗口：
- **VK701 振动传感器**：监听 `0.0.0.0:8234`
- **Modbus TCP 传感器**：监听 `0.0.0.0:502`（需管理员权限）
- **ZMotion 控制器**：监听 `0.0.0.0:8001`

### 手动启动

```bash
# 终端1 - VK701
python vk701_simulator.py

# 终端2 - Modbus TCP (需管理员权限)
python modbus_tcp_simulator.py

# 终端3 - ZMotion
python zmotion_simulator.py
```

## 测试连接

运行测试脚本检查所有模拟器是否正常运行：
```
test_connection.bat
```

或手动测试：
```bash
# 测试 VK701
telnet 127.0.0.1 8234

# 测试 Modbus TCP
telnet 127.0.0.1 502

# 测试 ZMotion
telnet 127.0.0.1 8001
GET_DPOS(0)
```

## 上位机连接配置

启动 `DrillControl.exe` 后，在"传感器采集控制"页面：

### VK701 配置
- 服务器地址：`127.0.0.1`（本地测试）
- 端口：`8234`（**必须是 8234**）
- 卡号：`0`
- 采样频率：`5000Hz`

### Modbus TCP 配置
- 服务器地址：`127.0.0.1`（本地测试）
- 端口：`502`
- 采样频率：`10Hz`

### ZMotion 配置
- 控制器地址：`127.0.0.1`（本地测试）
- 采样频率：`100Hz`

## 注意事项

1. **Modbus TCP 端口 502**：
   - Windows 可能需要管理员权限
   - 如果端口被占用，可以修改为其他端口（需同时修改上位机配置）

2. **防火墙**：
   - 首次运行时 Windows 可能会弹出防火墙提示
   - 请选择"允许访问"

3. **IP 地址**：
   - 本地测试使用 `127.0.0.1`
   - 实际硬件连接时使用原项目配置的 IP（见 README.md）

## 模拟数据说明

所有模拟器发送的都是**随机变化的数据**，用于测试上位机的数据采集和显示功能。

### VK701 数据
- 3 通道振动数据
- 每个数据包：1000 个采样点
- 数据为正弦波 + 谐波 + 随机噪声

### Modbus TCP 数据
- 上压力：1000-3000 N
- 下压力：500-1500 N
- 扭矩：50-150 N·m
- 位移：0-100 mm

### ZMotion 数据
- 位置：0-360 度
- 速度：-100~100 units/s
- 扭矩：0-10 N·m
- 电流：1-5 A

## 故障排查

**问题：连接被拒绝**
- 检查模拟器是否正常运行
- 运行 `test_connection.bat` 检查端口
- 检查防火墙设置

**问题：端口被占用**
- 检查是否有其他程序占用端口
- Windows: `netstat -ano | findstr "8234"`
- 结束占用端口的进程

**问题：权限不足（Modbus TCP）**
- 右键 `start_all_simulators.bat` → 以管理员身份运行
- 或修改 Modbus TCP 端口为大于 1024 的端口

## 完整测试流程

1. ✅ 启动所有模拟器
   ```
   start_all_simulators.bat
   ```

2. ✅ 验证连接
   ```
   test_connection.bat
   ```

3. ✅ 启动上位机
   ```
   DrillControl.exe
   ```

4. ✅ 连接传感器
   - 点击"连接 VK701"
   - 点击"连接 Modbus"
   - 点击"连接 ZMotion"
   - **如果连接失败，会有明确的错误提示**

5. ✅ 开始采集
   - 输入操作员名称
   - 点击"新建轮次"
   - 点击"启动所有采集"
   - 观察数据采集和数据库写入

6. ✅ 停止采集
   - 点击"停止所有采集"
   - 点击"结束当前轮次"

---

**创建日期**：2025-01-24  
**最后更新**：2025-01-24
