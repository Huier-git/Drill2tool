# è‡ªåŠ¨ä»»åŠ¡ç³»ç»Ÿä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: 1.0
**æ—¥æœŸ**: 2024-12-24
**é€‚ç”¨ç³»ç»Ÿ**: DrillControl v2.0+

---

## ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [ä»»åŠ¡é…ç½®è¯¦è§£](#ä»»åŠ¡é…ç½®è¯¦è§£)
4. [ç”¨æˆ·ç¡®è®¤æœºåˆ¶](#ç”¨æˆ·ç¡®è®¤æœºåˆ¶)
5. [ä¼ æ„Ÿå™¨çŠ¶æ€ç›‘æŽ§](#ä¼ æ„Ÿå™¨çŠ¶æ€ç›‘æŽ§)
6. [é’»è¿›é˜¶æ®µé…ç½®](#é’»è¿›é˜¶æ®µé…ç½®)
7. [å®‰å…¨ç›‘æµ‹](#å®‰å…¨ç›‘æµ‹)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## åŠŸèƒ½æ¦‚è¿°

è‡ªåŠ¨ä»»åŠ¡ç³»ç»Ÿå…è®¸é€šè¿‡ JSON é…ç½®æ–‡ä»¶å®šä¹‰å¤æ‚çš„é’»è¿›ä»»åŠ¡æµç¨‹ï¼Œæ”¯æŒï¼š

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **è‡ªåŠ¨åŒ–é’»è¿›æµç¨‹** - å®šä½ã€é’»è¿›ã€è¿”å›žå…¨è‡ªåŠ¨æ‰§è¡Œ
- âœ… **ç”¨æˆ·ç¡®è®¤æš‚åœ** - å…³é”®æ­¥éª¤è‡ªåŠ¨æš‚åœç­‰å¾…äººå·¥ç¡®è®¤
- âœ… **åˆ†é˜¶æ®µé’»è¿›** - æ”¯æŒ 3/5/8 æˆ–ä»»æ„æ•°é‡çš„é’»è¿›é˜¶æ®µ
- âœ… **å®žæ—¶å®‰å…¨ç›‘æµ‹** - åŠ›ä¼ æ„Ÿå™¨ã€æ‰­çŸ©ã€é€Ÿåº¦å…¨æ–¹ä½ç›‘æŽ§
- âœ… **ä¼ æ„Ÿå™¨çŠ¶æ€æŒ‡ç¤º** - å®žæ—¶æ˜¾ç¤º Modbus/ç”µæœº/æŒ¯åŠ¨ä¼ æ„Ÿå™¨è¿žæŽ¥çŠ¶æ€

### é€‚ç”¨åœºæ™¯
- é¦–æ¬¡é’»è¿›æµ‹è¯•
- å¤šé˜¶æ®µåœ°å±‚é’»è¿›
- æ ‡å‡†åŒ–é’»è¿›æµç¨‹
- å®žéªŒæ•°æ®é‡‡é›†

---

## å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å¯åŠ¨ç³»ç»Ÿ

1. å¯åŠ¨ DrillControl ä¸»ç¨‹åº
2. ç¡®ä¿æ•°æ®é‡‡é›†ç³»ç»Ÿå·²è¿žæŽ¥ï¼ˆæŸ¥çœ‹é¡¶éƒ¨çŠ¶æ€æ æŒ‡ç¤ºç¯ï¼‰
3. å¯¼èˆªåˆ° **AutoTaskPage** é¡µé¢

### æ­¥éª¤ 2: æ£€æŸ¥ä¼ æ„Ÿå™¨çŠ¶æ€

**é¡¶éƒ¨çŠ¶æ€æ å³ä¾§**ä¼šæ˜¾ç¤º 3 ä¸ªä¼ æ„Ÿå™¨çŠ¶æ€æŒ‡ç¤ºç¯ï¼š

| æŒ‡ç¤ºç¯ | å«ä¹‰ | çŠ¶æ€ |
|--------|------|------|
| **â— Modbus** | Modbus ä¼ æ„Ÿå™¨å·²è¿žæŽ¥ | ðŸŸ¢ ç»¿è‰² = æ­£å¸¸ |
| **Modbus** | Modbus ä¼ æ„Ÿå™¨ç¦»çº¿ | âšª ç°è‰² = ç¦»çº¿ |
| **â— ç”µæœº** | ZMotion æŽ§åˆ¶å™¨å·²è¿žæŽ¥ | ðŸŸ¢ ç»¿è‰² = æ­£å¸¸ |
| **ç”µæœº** | ZMotion æŽ§åˆ¶å™¨ç¦»çº¿ | âšª ç°è‰² = ç¦»çº¿ |
| **â— æŒ¯åŠ¨** | VK701 æŒ¯åŠ¨ä¼ æ„Ÿå™¨å·²è¿žæŽ¥ | ðŸŸ¢ ç»¿è‰² = æ­£å¸¸ |
| **æŒ¯åŠ¨** | VK701 æŒ¯åŠ¨ä¼ æ„Ÿå™¨ç¦»çº¿ | âšª ç°è‰² = ç¦»çº¿ |

âš ï¸ **é‡è¦**: æ‰§è¡Œä»»åŠ¡å‰ï¼Œç¡®ä¿è‡³å°‘ **Modbus** å’Œ **ç”µæœº** ä¸¤ä¸ªæŒ‡ç¤ºç¯ä¸ºç»¿è‰²ã€‚

### æ­¥éª¤ 3: åŠ è½½ä»»åŠ¡

1. ç‚¹å‡» **ã€ŒåŠ è½½ä»»åŠ¡ã€** æŒ‰é’®
2. ä»Žä»»åŠ¡åˆ—è¡¨ä¸­é€‰æ‹© **`task_test_simple_drilling.json`**
3. æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…ï¼š
   - å·¦ä¾§æ˜¾ç¤ºä»»åŠ¡æ­¥éª¤ï¼ˆ8 æ­¥ï¼‰
   - å³ä¾§æ˜¾ç¤ºé¢„è®¾å‚æ•°ï¼ˆ4 ä¸ªé¢„è®¾ï¼‰
4. ç¡®è®¤ä»»åŠ¡é…ç½®æ­£ç¡®

### æ­¥éª¤ 4: æ‰§è¡Œä»»åŠ¡

1. ç‚¹å‡» **ã€Œå¼€å§‹ã€** æŒ‰é’®
2. ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œæ­¥éª¤ 1ï¼ˆç§»åŠ¨åˆ°é¡¶éƒ¨ï¼‰
3. **æ­¥éª¤ 2 è‡ªåŠ¨æš‚åœ** - æ˜¾ç¤º "ç­‰å¾…ç”¨æˆ·ç¡®è®¤ - è¯·ç‚¹å‡»ã€Œç»§ç»­ã€æŒ‰é’®"
4. **äººå·¥æ“ä½œ**: å®‰è£…é’»ç®¡åˆ°è¿›ç»™æœºæž„
5. ç‚¹å‡» **ã€Œç»§ç»­ã€** æŒ‰é’®
6. ç³»ç»Ÿç»§ç»­æ‰§è¡Œæ­¥éª¤ 3-6ï¼ˆå®šä½åˆ°åœŸå£¤è¡¨é¢ â†’ 3 é˜¶æ®µé’»è¿›ï¼‰
7. **æ­¥éª¤ 7 è‡ªåŠ¨æš‚åœ** - é’»è¿›å®Œæˆ
8. ç‚¹å‡» **ã€Œç»§ç»­ã€** æŒ‰é’®
9. ç³»ç»Ÿæ‰§è¡Œæ­¥éª¤ 8ï¼ˆè¿”å›žé¡¶éƒ¨ï¼‰- ä»»åŠ¡å®Œæˆ

### ç´§æ€¥æƒ…å†µå¤„ç†

| æŒ‰é’® | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| **æš‚åœ** | æš‚åœä»»åŠ¡æ‰§è¡Œ | éœ€è¦ä¸´æ—¶åœæ­¢æ—¶ |
| **ç»§ç»­** | æ¢å¤ä»»åŠ¡æ‰§è¡Œ | æš‚åœåŽç»§ç»­/ç”¨æˆ·ç¡®è®¤åŽç»§ç»­ |
| **åœæ­¢** | ç»ˆæ­¢ä»»åŠ¡ | ä»»åŠ¡å¼‚å¸¸éœ€è¦ä¸­æ­¢ |
| **æ€¥åœ** | ç´§æ€¥åœæœº | å±é™©æƒ…å†µç«‹å³åœæ­¢æ‰€æœ‰è¿åŠ¨ |

---

## ä»»åŠ¡é…ç½®è¯¦è§£

### ä»»åŠ¡æ–‡ä»¶ç»“æž„

```json
{
  "task_name": "ä»»åŠ¡åç§°",
  "description": "ä»»åŠ¡æè¿°",
  "version": "1.0",

  "presets": {
    "é¢„è®¾ID": {
      "id": "é¢„è®¾ID",
      "description": "é¢„è®¾æè¿°",
      "vp_mm_per_min": 50.0,    // è¿›ç»™é€Ÿåº¦ (mm/min)
      "rpm": 60.0,               // å›žè½¬é€Ÿåº¦ (rpm)
      "fi_hz": 0.0,              // å†²å‡»é¢‘çŽ‡ (Hz, æµ‹è¯•ä»»åŠ¡ä¸º0)
      "torque_limit_nm": 1200.0, // æ‰­çŸ©é™åˆ¶
      "pressure_limit_n": 10000.0 // é’»åŽ‹é™åˆ¶
      // ... å…¶ä»–å®‰å…¨å‚æ•°
    }
  },

  "steps": [
    {
      "type": "positioning",           // æ­¥éª¤ç±»åž‹
      "target_depth": 1001.0,          // ç›®æ ‡æ·±åº¦ (mm)
      "param_id": "P_IDLE",            // ä½¿ç”¨çš„é¢„è®¾ID
      "timeout": 60,                   // è¶…æ—¶æ—¶é—´ (ç§’)
      "description": "æ­¥éª¤æè¿°"
    }
  ]
}
```

### æ­¥éª¤ç±»åž‹

| ç±»åž‹ | è¯´æ˜Ž | å‚æ•°è¦æ±‚ |
|------|------|---------|
| **positioning** | ç©ºè½½å®šä½ç§»åŠ¨ | target_depth, param_id |
| **drilling** | é’»è¿›æ“ä½œ | target_depth, param_id, conditions (å¯é€‰) |
| **hold** | ä¿æŒ/ç­‰å¾… | hold_time æˆ– requires_user_confirmation |

### åæ ‡ç³»ç»Ÿ

**è¿›ç»™æœºæž„ (Fz)** é‡‡ç”¨ **åº•éƒ¨å‘ä¸Š** çš„åæ ‡ç³»ç»Ÿï¼š

| ä½ç½®ä»£å· | ç‰©ç†ä½ç½® | æ·±åº¦å€¼ (mm) | è„‰å†²å€¼ (pulses) |
|----------|---------|------------|----------------|
| **A** | æœ€åº•éƒ¨ | 0.0 | 0 |
| **K** | åœŸå£¤è¡¨é¢ | 917.0 | 12,000,000 |
| **H** | æœ€é¡¶éƒ¨ | 1001.0 | 13,100,000 |

**ç¤ºä¾‹**: ä»Žé¡¶éƒ¨ (H=1001mm) é’»è¿›åˆ° 84mm æ·±åº¦ï¼Œå®žé™…é’»è¿›æ·±åº¦ = 1001 - 84 = 917mm

---

## ç”¨æˆ·ç¡®è®¤æœºåˆ¶

### ä»€ä¹ˆæ˜¯ç”¨æˆ·ç¡®è®¤ï¼Ÿ

ç”¨æˆ·ç¡®è®¤å…è®¸ä»»åŠ¡åœ¨å…³é”®æ­¥éª¤è‡ªåŠ¨æš‚åœï¼Œç­‰å¾…æ“ä½œå‘˜äººå·¥ç¡®è®¤åŽç»§ç»­ã€‚

### é…ç½®æ–¹æ³•

åœ¨ `hold` æ­¥éª¤ä¸­æ·»åŠ  `requires_user_confirmation: true`ï¼š

```json
{
  "type": "hold",
  "hold_time": 0,
  "requires_user_confirmation": true,
  "description": "ç­‰å¾…å®‰è£…é’»ç®¡ - è¯·ç‚¹å‡»ã€Œç»§ç»­ã€æŒ‰é’®"
}
```

### è¡Œä¸ºè¯´æ˜Ž

| å­—æ®µ | å€¼ | è¡Œä¸º |
|------|---|------|
| `requires_user_confirmation` | `true` | è‡ªåŠ¨æš‚åœï¼Œæ— é™ç­‰å¾…ï¼Œç›´åˆ°ç”¨æˆ·ç‚¹å‡»ã€Œç»§ç»­ã€ |
| `requires_user_confirmation` | `false` æˆ– ç¼ºçœ | ä½¿ç”¨ `hold_time` å®šæ—¶å™¨ï¼Œè‡ªåŠ¨å®Œæˆ |

### å…¸åž‹åº”ç”¨åœºæ™¯

1. **å®‰è£…é’»ç®¡** - å®šä½åˆ°é¡¶éƒ¨åŽï¼Œç­‰å¾…äººå·¥å®‰è£…é’»ç®¡
2. **æ›´æ¢é’»å¤´** - é’»å…·ç£¨æŸåŽï¼Œç­‰å¾…æ›´æ¢é’»å¤´
3. **æ£€æŸ¥è®¾å¤‡** - å…³é”®æ­¥éª¤å‰ï¼Œç¡®è®¤è®¾å¤‡çŠ¶æ€
4. **å®žéªŒè®°å½•** - é˜¶æ®µæ€§ç­‰å¾…ï¼Œè®°å½•å®žéªŒæ•°æ®

### ç¤ºä¾‹ä»»åŠ¡æµç¨‹

```
æ­¥éª¤ 1: positioning â†’ H (1001mm)        [è‡ªåŠ¨æ‰§è¡Œ]
æ­¥éª¤ 2: hold (ç¡®è®¤æ¨¡å¼)                   [ðŸ›‘ æš‚åœç­‰å¾…]
        â†“ ç”¨æˆ·ç‚¹å‡»ã€Œç»§ç»­ã€
æ­¥éª¤ 3: positioning â†’ K (917mm)        [è‡ªåŠ¨æ‰§è¡Œ]
æ­¥éª¤ 4-6: drilling (3é˜¶æ®µ)              [è‡ªåŠ¨æ‰§è¡Œ]
æ­¥éª¤ 7: hold (ç¡®è®¤æ¨¡å¼)                   [ðŸ›‘ æš‚åœç­‰å¾…]
        â†“ ç”¨æˆ·ç‚¹å‡»ã€Œç»§ç»­ã€
æ­¥éª¤ 8: positioning â†’ H (1001mm)        [è‡ªåŠ¨æ‰§è¡Œ]
```

---

## ä¼ æ„Ÿå™¨çŠ¶æ€ç›‘æŽ§

### å®žæ—¶ç›‘æŽ§

ç³»ç»Ÿæ¯ **500ms** è‡ªåŠ¨æ£€æµ‹ä¼ æ„Ÿå™¨è¿žæŽ¥çŠ¶æ€ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°ã€‚

### çŠ¶æ€æŒ‡ç¤º

**é¡¶éƒ¨çŠ¶æ€æ å³ä¾§** æ˜¾ç¤º 3 ä¸ªæŒ‡ç¤ºç¯ï¼š

```
[çŠ¶æ€: ç©ºé—²] [åŠ è½½ä»»åŠ¡] [é‡æ–°åŠ è½½] [      ] [â— Modbus] [â— ç”µæœº] [â— æŒ¯åŠ¨]
                                           â†‘ ç»¿è‰²=å·²è¿žæŽ¥
                                           â†‘ ç°è‰²=ç¦»çº¿
```

### æ•…éšœæŽ’æŸ¥

| çŽ°è±¡ | å¯èƒ½åŽŸå›  | è§£å†³æ–¹æ³• |
|------|---------|---------|
| **Modbus ç°è‰²** | Modbus ä¼ æ„Ÿå™¨æœªè¿žæŽ¥ | æ£€æŸ¥ç½‘ç»œè¿žæŽ¥ï¼Œé‡å¯ MdbWorker |
| **ç”µæœº ç°è‰²** | ZMotion æŽ§åˆ¶å™¨ç¦»çº¿ | æ£€æŸ¥æŽ§åˆ¶å™¨ç”µæºå’Œ EtherCAT æ€»çº¿ |
| **æŒ¯åŠ¨ ç°è‰²** | VK701 ä¼ æ„Ÿå™¨æœªè¿žæŽ¥ | æ£€æŸ¥ VK701 ç¡¬ä»¶è¿žæŽ¥ |
| **æ‰€æœ‰ç°è‰²** | AcquisitionManager æœªåˆå§‹åŒ– | æ£€æŸ¥æ•°æ®é‡‡é›†ç³»ç»Ÿé…ç½® |

### ä»»åŠ¡æ‰§è¡Œè¦æ±‚

| ä¼ æ„Ÿå™¨ | æ˜¯å¦å¿…éœ€ | è¯´æ˜Ž |
|--------|---------|------|
| **Modbus** | âœ… å¿…éœ€ | åŠ›ä¼ æ„Ÿå™¨æ•°æ®ç”¨äºŽå®‰å…¨ç›‘æµ‹ |
| **ç”µæœº** | âœ… å¿…éœ€ | ç”µæœºæŽ§åˆ¶å’Œä½ç½®åé¦ˆ |
| **æŒ¯åŠ¨** | âšª å¯é€‰ | ç”¨äºŽæŒ¯åŠ¨ç›‘æµ‹å’Œæ•°æ®è®°å½• |

âš ï¸ **å¯åŠ¨ä»»åŠ¡å‰æ£€æŸ¥**: å¦‚æžœ Modbus æˆ–ç”µæœºæŒ‡ç¤ºç¯ä¸ºç°è‰²ï¼Œä»»åŠ¡å°†æ‹’ç»å¯åŠ¨ã€‚

---

## é’»è¿›é˜¶æ®µé…ç½®

### çµæ´»çš„é˜¶æ®µåˆ’åˆ†

é’»è¿›é˜¶æ®µæ•°é‡ **å®Œå…¨ç”±ç”¨æˆ·åœ¨ JSON ä¸­å®šä¹‰**ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

### é»˜è®¤é…ç½®ï¼ˆ3 é˜¶æ®µï¼‰

```json
{
  "steps": [
    {
      "type": "drilling",
      "target_depth": 617.0,
      "param_id": "P_DRILL_STAGE1",
      "description": "ç¬¬1é˜¶æ®µï¼ˆ0-300mmï¼Œ30rpmä½Žé€Ÿï¼‰"
    },
    {
      "type": "drilling",
      "target_depth": 317.0,
      "param_id": "P_DRILL_STAGE2",
      "description": "ç¬¬2é˜¶æ®µï¼ˆ300-600mmï¼Œ60rpmä¸­é€Ÿï¼‰"
    },
    {
      "type": "drilling",
      "target_depth": 84.0,
      "param_id": "P_DRILL_STAGE3",
      "description": "ç¬¬3é˜¶æ®µï¼ˆ600mm+ï¼Œ90rpmé«˜é€Ÿï¼‰"
    }
  ]
}
```

### æ‰©å±•ä¸º 5 é˜¶æ®µç¤ºä¾‹

1. **æ·»åŠ æ–°é¢„è®¾** (åœ¨ `presets` ä¸­):

```json
"P_DRILL_STAGE4": {
  "id": "P_DRILL_STAGE4",
  "description": "é’»è¿›ç¬¬4é˜¶æ®µï¼ˆ750-900mmï¼Œ100rpmï¼‰",
  "vp_mm_per_min": 80.0,
  "rpm": 100.0,
  // ... å…¶ä»–å‚æ•°
},
"P_DRILL_STAGE5": {
  "id": "P_DRILL_STAGE5",
  "description": "é’»è¿›ç¬¬5é˜¶æ®µï¼ˆ900mm+ï¼Œ120rpmï¼‰",
  "vp_mm_per_min": 90.0,
  "rpm": 120.0,
  // ... å…¶ä»–å‚æ•°
}
```

2. **æ·»åŠ æ–°æ­¥éª¤** (åœ¨ `steps` ä¸­):

```json
{
  "type": "drilling",
  "target_depth": 217.0,
  "param_id": "P_DRILL_STAGE4",
  "description": "ç¬¬4é˜¶æ®µï¼ˆ750-900mmï¼Œ100rpmï¼‰"
},
{
  "type": "drilling",
  "target_depth": 84.0,
  "param_id": "P_DRILL_STAGE5",
  "description": "ç¬¬5é˜¶æ®µï¼ˆ900mm+ï¼Œ120rpmï¼‰"
}
```

### é˜¶æ®µåˆ’åˆ†ç­–ç•¥

| ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | é˜¶æ®µæ•°é‡ |
|------|---------|---------|
| **æŒ‰æ·±åº¦ç­‰åˆ†** | åœ°è´¨æ¡ä»¶å‡åŒ€ | 3-5 æ®µ |
| **æŒ‰åœ°å±‚ç‰¹æ€§** | å·²çŸ¥åœ°å±‚åˆ†å¸ƒ | 5-8 æ®µ |
| **æŒ‰é€Ÿåº¦æ¢¯åº¦** | é€æ­¥åŠ é€Ÿé’»è¿› | 8+ æ®µ |
| **æ··åˆç­–ç•¥** | å¤æ‚åœ°è´¨æ¡ä»¶ | çµæ´»é…ç½® |

### é˜¶æ®µå‚æ•°è°ƒæ•´å»ºè®®

| å‚æ•° | è½¯åœ°å±‚ | ä¸­ç­‰åœ°å±‚ | ç¡¬åœ°å±‚ |
|------|--------|---------|--------|
| **rpm** | 20-40 | 60-80 | 100-120 |
| **vp_mm_per_min** | 20-40 | 50-70 | 80-100 |
| **torque_limit_nm** | 800-1000 | 1200-1400 | 1600-2000 |
| **pressure_limit_n** | 6000-8000 | 10000-12000 | 15000-18000 |

---

## å®‰å…¨ç›‘æµ‹

### å®žæ—¶ç›‘æµ‹é¡¹ç›®

ç³»ç»Ÿé€šè¿‡ **SafetyWatchdog** å®žæ—¶ç›‘æµ‹ä»¥ä¸‹å‚æ•°ï¼š

| ç›‘æµ‹é¡¹ | é˜ˆå€¼æ¥æº | è§¦å‘æ¡ä»¶ | æ•…éšœç  |
|--------|---------|---------|--------|
| **ç´§æ€¥åŠ›é™åˆ¶** | emergencyForceLimit | ä»»ä¸€åŠ›ä¼ æ„Ÿå™¨è¶…ç´§æ€¥é™åˆ¶ | EMERGENCY_FORCE |
| **ä¸ŠåŠ›ä¼ æ„Ÿå™¨** | upperForceLimit | ä¸ŠåŠ›ä¼ æ„Ÿå™¨è¶…é™ | FORCE_UPPER_LIMIT |
| **ä¸‹åŠ›ä¼ æ„Ÿå™¨** | lowerForceLimit | è¿åŠ¨æ—¶ä¸‹åŠ›ä¸è¶³ | FORCE_LOWER_LIMIT |
| **æ‰­çŸ©é™åˆ¶** | torqueLimitNm | æ‰­çŸ©è¶…é™ | TORQUE_LIMIT |
| **é’»åŽ‹é™åˆ¶** | pressureLimitN | é’»åŽ‹è¶…é™ | PRESSURE_LIMIT |
| **æœ€å¤§è¿›ç»™é€Ÿåº¦** | maxFeedSpeedMmPerMin | é€Ÿåº¦è¶…é™ | MAX_FEED_SPEED |
| **é€Ÿåº¦å˜åŒ–çŽ‡** | velocityChangeLimitMmPerSec | åŠ é€Ÿåº¦è¶…é™ | VELOCITY_CHANGE_RATE |
| **å µè½¬æ£€æµ‹** | stallVelocityMmPerMin | é€Ÿåº¦è¿‡ä½Ž | STALL_DETECTED |

### æ¡ä»¶åœæ­¢

æ¯ä¸ªé’»è¿›æ­¥éª¤å¯é…ç½® **æ¡ä»¶åœæ­¢** è§„åˆ™ï¼š

```json
{
  "type": "drilling",
  "target_depth": 617.0,
  "param_id": "P_DRILL_STAGE1",
  "conditions": {
    "stop_if": [
      { "sensor": "force_upper", "op": ">", "value": 600 },
      { "sensor": "torque", "op": ">", "value": 1000 }
    ],
    "logic": "OR",              // OR: ä»»ä¸€æ¡ä»¶æ»¡è¶³å³åœæ­¢
    "abort_on_stop": true       // è§¦å‘åŽä¸­æ­¢ä»»åŠ¡
  }
}
```

**æ”¯æŒçš„ä¼ æ„Ÿå™¨**:
- `force_upper` - ä¸ŠåŠ›ä¼ æ„Ÿå™¨ (N)
- `force_lower` - ä¸‹åŠ›ä¼ æ„Ÿå™¨ (N)
- `torque` - æ‰­çŸ© (Nm)
- `pressure` - é’»åŽ‹ (N)
- `feed_velocity` - è¿›ç»™é€Ÿåº¦ (mm/min)
- `feed_depth` - å½“å‰æ·±åº¦ (mm)
- `stall` - å µè½¬çŠ¶æ€ (true/false)

**æ”¯æŒçš„æ“ä½œç¬¦**: `>`, `>=`, `<`, `<=`, `==`

### æ•…éšœå¤„ç†æµç¨‹

1. **æ£€æµ‹åˆ°æ•…éšœ** â†’ ç³»ç»Ÿè‡ªåŠ¨åœæ­¢æ‰€æœ‰è¿åŠ¨
2. **æ˜¾ç¤ºæ•…éšœä¿¡æ¯** â†’ æ—¥å¿—çª—å£æ˜¾ç¤ºæ•…éšœç å’Œè¯¦æƒ…
3. **ä»»åŠ¡çŠ¶æ€å˜ä¸º Error** â†’ é¡¶éƒ¨çŠ¶æ€æ æ˜¾ç¤ºé”™è¯¯
4. **äººå·¥å¹²é¢„** â†’ æŽ’æŸ¥æ•…éšœåŽŸå› ï¼Œä¿®å¤é—®é¢˜
5. **æ¸…é™¤ä»»åŠ¡** â†’ ç‚¹å‡»ã€Œåœæ­¢ã€æŒ‰é’®
6. **é‡æ–°åŠ è½½ä»»åŠ¡** â†’ ä¿®æ”¹å‚æ•°åŽé‡æ–°æ‰§è¡Œ

---

## å¸¸è§é—®é¢˜

### Q1: ä»»åŠ¡å¯åŠ¨å¤±è´¥ï¼Œæç¤º"ä¼ æ„Ÿå™¨æ•°æ®æœªè¿žæŽ¥"ï¼Ÿ

**åŽŸå› **: Modbus æˆ–ç”µæœºä¼ æ„Ÿå™¨ç¦»çº¿ã€‚

**è§£å†³æ–¹æ³•**:
1. æŸ¥çœ‹é¡¶éƒ¨ä¼ æ„Ÿå™¨æŒ‡ç¤ºç¯
2. ç¡®ä¿ **Modbus** å’Œ **ç”µæœº** æŒ‡ç¤ºç¯ä¸ºç»¿è‰²
3. å¦‚æžœç°è‰²ï¼Œæ£€æŸ¥ç¡¬ä»¶è¿žæŽ¥å’Œæ•°æ®é‡‡é›†ç³»ç»Ÿ

### Q2: å¦‚ä½•ä¿®æ”¹é’»è¿›é€Ÿåº¦ï¼Ÿ

**æ–¹æ³• 1**: ä¿®æ”¹ä»»åŠ¡ JSON æ–‡ä»¶ä¸­çš„é¢„è®¾å‚æ•°ï¼š
```json
"P_DRILL_STAGE1": {
  "vp_mm_per_min": 30.0,  // ä¿®æ”¹è¿›ç»™é€Ÿåº¦
  "rpm": 30.0             // ä¿®æ”¹å›žè½¬é€Ÿåº¦
}
```

**æ–¹æ³• 2**: åˆ›å»ºæ–°é¢„è®¾ï¼Œåœ¨æ­¥éª¤ä¸­å¼•ç”¨æ–°é¢„è®¾ IDã€‚

### Q3: å¦‚ä½•è·³è¿‡ç”¨æˆ·ç¡®è®¤æ­¥éª¤ï¼Ÿ

å°† `requires_user_confirmation` æ”¹ä¸º `false` æˆ–åˆ é™¤è¯¥å­—æ®µï¼š

```json
{
  "type": "hold",
  "hold_time": 2,                        // ä½¿ç”¨å®šæ—¶å™¨
  "requires_user_confirmation": false,   // æˆ–åˆ é™¤æ­¤è¡Œ
  "description": "ç­‰å¾…2ç§’"
}
```

### Q4: é’»è¿›è¿‡ç¨‹ä¸­è§¦å‘ FORCE_UPPER_LIMIT æ•…éšœï¼Ÿ

**åŽŸå› **: ä¸ŠåŠ›ä¼ æ„Ÿå™¨è¶…è¿‡é¢„è®¾é˜ˆå€¼ã€‚

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ `upperForceLimit` å‚æ•°æ˜¯å¦è¿‡ä½Ž
2. æ£€æŸ¥é’»å…·æ˜¯å¦å¡ä½
3. è°ƒæ•´è¿›ç»™é€Ÿåº¦æˆ–å›žè½¬é€Ÿåº¦
4. å¢žå¤§ `upperForceLimit` å€¼ï¼ˆéœ€æ ¹æ®å®žé™…æƒ…å†µè°ƒæ•´ï¼‰

### Q5: å¦‚ä½•æ·»åŠ æ›´å¤šé’»è¿›é˜¶æ®µï¼Ÿ

å‚è§ [é’»è¿›é˜¶æ®µé…ç½®](#é’»è¿›é˜¶æ®µé…ç½®) ç« èŠ‚ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. åœ¨ `presets` ä¸­æ·»åŠ æ–°é¢„è®¾ï¼ˆP_DRILL_STAGE4, P_DRILL_STAGE5...ï¼‰
2. åœ¨ `steps` ä¸­æ·»åŠ å¯¹åº”çš„ drilling æ­¥éª¤
3. è°ƒæ•´å„é˜¶æ®µçš„ `target_depth` å’Œå‚æ•°
4. ä¿å­˜ JSON æ–‡ä»¶ï¼Œé‡æ–°åŠ è½½ä»»åŠ¡

**æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç ï¼**

### Q6: ä»»åŠ¡æ‰§è¡Œä¸­å¯ä»¥æš‚åœå—ï¼Ÿ

âœ… å¯ä»¥ã€‚ç‚¹å‡» **ã€Œæš‚åœã€** æŒ‰é’®ï¼Œç³»ç»Ÿä¼šåœæ­¢æ‰€æœ‰è¿åŠ¨å¹¶ä¿æŒå½“å‰ä½ç½®ã€‚

ç‚¹å‡» **ã€Œç»§ç»­ã€** æŒ‰é’®å¯æ¢å¤æ‰§è¡Œã€‚

âš ï¸ **æ³¨æ„**: æš‚åœåŽä½ç½®å¯èƒ½ç•¥æœ‰åç§»ï¼Œæ¢å¤æ—¶ä¼šé‡æ–°æ‰§è¡Œå½“å‰æ­¥éª¤ã€‚

### Q7: å¦‚ä½•æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼Ÿ

æ—¥å¿—æ˜¾ç¤ºåœ¨ **AutoTaskPage** å³ä¸‹æ–¹çš„æ—¥å¿—çª—å£ï¼ŒåŒ…å«ï¼š
- ä»»åŠ¡çŠ¶æ€å˜åŒ–
- æ­¥éª¤å¼€å§‹/å®Œæˆ
- ä¼ æ„Ÿå™¨æ•°æ®æ›´æ–°
- æ•…éšœä¿¡æ¯

æ—¥å¿—ä¼šè‡ªåŠ¨æ»šåŠ¨æ˜¾ç¤ºæœ€æ–°ä¿¡æ¯ã€‚

### Q8: ç´§æ€¥æƒ…å†µä¸‹å¦‚ä½•åœæ­¢ï¼Ÿ

ç‚¹å‡» **ã€Œæ€¥åœã€** æŒ‰é’®ï¼Œç³»ç»Ÿä¼šï¼š
1. ç«‹å³åœæ­¢æ‰€æœ‰ç”µæœº
2. é‡Šæ”¾è¿åŠ¨é”
3. ä¸­æ­¢å½“å‰ä»»åŠ¡
4. è§¦å‘å…¨å±€æ€¥åœé“¾

âš ï¸ **æ€¥åœåŽéœ€è¦æ‰‹åŠ¨å¤ä½ç³»ç»Ÿã€‚**

---

## é™„å½•

### A. ä»»åŠ¡æ–‡ä»¶ä½ç½®

- **ç³»ç»Ÿä»»åŠ¡ç›®å½•**: `config/auto_tasks/`
- **ç¤ºä¾‹ä»»åŠ¡**: `config/auto_tasks/task_test_simple_drilling.json`
- **ç”¨æˆ·è‡ªå®šä¹‰ä»»åŠ¡**: å¯æ”¾ç½®åœ¨åŒä¸€ç›®å½•

### B. ç›¸å…³æ–‡æ¡£

- `docs/MOTION_INTERLOCK_SYSTEM.md` - è¿åŠ¨äº’é”ç³»ç»Ÿè®¾è®¡
- `docs/MECHANISM_CONTROLLERS_GUIDE.md` - æœºæž„æŽ§åˆ¶å™¨è§„èŒƒ
- `docs/SAFETY_WATCHDOG_MIGRATION.md` - å®‰å…¨ç›‘æµ‹ç³»ç»Ÿè¿ç§»æŠ¥å‘Š
- `docs/KEY_POSITIONS_GUIDE.md` - å…³é”®ä½ç½®å®šä¹‰

### C. æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³» DrillControl å¼€å‘å›¢é˜Ÿã€‚

æä¾›ä»¥ä¸‹ä¿¡æ¯æœ‰åŠ©äºŽå¿«é€Ÿå®šä½é—®é¢˜ï¼š
- ä»»åŠ¡ JSON æ–‡ä»¶
- æ—¥å¿—çª—å£æˆªå›¾
- ä¼ æ„Ÿå™¨çŠ¶æ€æŒ‡ç¤ºç¯çŠ¶æ€
- æ•…éšœå‘ç”Ÿæ—¶çš„æ·±åº¦å’Œé€Ÿåº¦

---

**æ–‡æ¡£ç»´æŠ¤**: DrillControl å¼€å‘å›¢é˜Ÿ
**æœ€åŽæ›´æ–°**: 2024-12-24
